<script>
const api = "https://script.google.com/macros/s/AKfycbzZ8NuuRbkTlqrG_vZawbQ08jQahBp-Y-1VJjkvDIcnlxrVVLw8UoqhelcfXkR6qJdPgA/exec";

function fetchData() {
  fetch(api, {
    method: "POST",
    body: JSON.stringify({ action: "read" })
  })
  .then(res => res.json())
  .then(data => {
    const html = data.map(row => `
      <div>
        <b>${row.Name}</b> (${row.Email}) — ${row.Message}
        <button onclick="editData(${row.ID})">✏️</button>
        <button onclick="deleteData(${row.ID})">🗑️</button>
      </div>
    `).join('');
    document.getElementById("output").innerHTML = html;
  });
}

function addData() {
  const body = {
    action: "create",
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    message: document.getElementById("message").value
  };
  fetch(api, { method: "POST", body: JSON.stringify(body) })
    .then(() => fetchData());
}

function editData(id) {
  const name = prompt("New name:");
  const email = prompt("New email:");
  const message = prompt("New message:");
  const body = { action: "update", id, name, email, message };
  fetch(api, { method: "POST", body: JSON.stringify(body) })
    .then(() => fetchData());
}

function deleteData(id) {
  const body = { action: "delete", id };
  fetch(api, { method: "POST", body: JSON.stringify(body) })
    .then(() => fetchData());
}

fetchData();
</script>
